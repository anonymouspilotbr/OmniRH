<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Redefinir Senha</title>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body class="bg-gray-50 flex items-center justify-center min-h-screen">
        <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold text-blue-600 mb-4">Redefinir Senha</h2>
            <p class="text-gray-600 mb-6">Digite sua nova senha abaixo</p>

            <form id="reset-form">
                <label class="block text-gray-700 font-semibold mb-2" for="senha">Nova Senha</label>
                <input type="password" id="senha" required class="w-full border rounded-lg p-2 mb-4" placeholder="Digite a nova senha">

                <label class="block text-gray-700 font-semibold mb-2" for="confirmar">Confirmar Senha</label>
                <input type="password" id="confirmar" required class="w-full border rounded-lg p-2 mb-4" placeholder="Confirme a nova senha">

                <div id="erro-reset" class="bg-red-100 text-red-700 p-2 rounded-md text-center mb-3 hidden"></div>

                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-700 transition">
                    Atualizar Senha
                </button>
            </form>
        </div>

        <script>
            document.getElementById("reset-form").addEventListener("submit", async (e) => {
                e.preventDefault();
                const senha = document.getElementById("senha").value;
                const confirmar = document.getElementById("confirmar").value;
                const erroBox = document.getElementById("erro-reset");

                if (senha !== confirmar) {
                    erroBox.textContent = "As senhas não coincidem!";
                    erroBox.classList.remove("hidden");
                    return;
                }

                const params = new URLSearchParams(window.location.search);
                const token = params.get("token");

                if (!token) {
                    erroBox.textContent = "Token inválido!";
                    erroBox.classList.remove("hidden");
                    return;
                }

                try {
                    const res = await fetch("/auth/reset-password", {
                        method: "POST",
                        headers: {"Content-Type": "application/json"},
                        body: JSON.stringify({ token, novaSenha: senha })
                    });

                    const data = await res.json();
                    if (!res.ok) throw new Error(data.error || "Erro ao redefinir senha");

                    alert("Senha redefinida com sucesso!");
                    window.location.href = "/login.html";
                } catch (err) {
                    erroBox.textContent = err.message;
                    erroBox.classList.remove("hidden");
                }
            });
        </script>
    </body>
</html>
