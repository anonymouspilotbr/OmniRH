<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>OmniRH — Administração de Empresas</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
        <style>
            /* mantendo as métricas do modelo inicial (padding, raios, tipografia) para consistência com outras páginas */
            :root{
                --primary: #0f172a;       /* deep blue */
                --accent:  #0ea5e9;       /* cyan */
                --card-radius: 1rem;      /* rounded-2xl */
                --card-padding: 2rem;     /* p-8 */
                --shadow: 0 10px 30px rgba(2,6,23,0.08);
            }

            body{
                font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
                -webkit-font-smoothing:antialiased;
                -moz-osx-font-smoothing:grayscale;
            }

            /* card padrão com as mesmas métricas do modelo de referência */
            .card {
                background: #ffffff;
                border-radius: var(--card-radius);
                box-shadow: var(--shadow);
                padding: var(--card-padding);
            }

            .muted { color: #6b7280; } /* gray-500 */
            .accent-text { color: var(--accent); }

            /* Inputs com foco consistente (mesma aparência do modelo) */
            input:focus, select:focus, textarea:focus {
                outline: none;
                border-color: rgba(14,165,233,0.9);
                box-shadow: 0 6px 20px rgba(14,165,233,0.06);
            }

            /* animação leve ao mostrar form (igual ao que já existia) */
            @keyframes fadeInUp {
                from { opacity: 0; transform: translateY(6px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .animate-in { animation: fadeInUp 220ms ease-out; }

            .avatar-placeholder { background: linear-gradient(90deg,#0ea5e9,#6366f1); color:white; display:inline-flex; align-items:center; justify-content:center; border-radius:999px; }
        </style>
    </head>
    <body class="bg-gray-50 min-h-screen">
        <!-- Header -->
        <header class="bg-blue-600 text-white shadow-lg">
             <div class="container mx-auto px-4 py-4 flex items-center justify-between">
                 <div class="flex items-center gap-4">
                     <button id="menuButton" class="p-2 text-gray-600 hover:bg-gray-100 rounded-md"><i class="fa-solid fa-bars"></i></button>
                     <div>
                        <h1 class="text-2xl font-bold">OmniRH</h1>
                        <p class="text-sm text-blue-100">Painel do Administrador — Gestão de Empresas</p>
                     </div>
                 </div>
 
                 <div class="flex items-center gap-4">
                     <button id="openFormBtn" class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-lg shadow hover:brightness-95 transition">
                         <i class="fa-solid fa-plus"></i> Cadastrar
                     </button>
 
                     <div class="text-right hidden md:block">
                        <p class="font-semibold">Administrador</p>
                        <p class="text-sm text-blue-100">Admin</p>
                     </div>
 
                     <div class="w-10 h-10 avatar-placeholder">
                         <i class="fas fa-user"></i>
                     </div>
                 </div>
             </div>
         </header>

        <main class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Formulário (oculto por padrão) -->
                <section id="formSection" class="col-span-1 card p-6 hidden">
                    <h2 id="formTitle" class="text-lg font-semibold mb-3">Cadastrar nova empresa</h2>
                    <form id="empresaForm" class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium muted">Nome da Empresa</label>
                            <input id="nome" required class="mt-1 w-full border border-gray-200 rounded-md px-3 py-2 bg-white" />
                        </div>

                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-sm font-medium muted">CNPJ</label>
                                <input id="cnpj" class="mt-1 w-full border border-gray-200 rounded-md px-3 py-2 bg-white" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium muted">Status</label>
                                <select id="status" class="mt-1 w-full border border-gray-200 rounded-md px-3 py-2 bg-white">
                                    <option value="Ativa">Ativa</option>
                                    <option value="Inativa">Inativa</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium muted">Setor / Atividade</label>
                            <input id="setor" class="mt-1 w-full border border-gray-200 rounded-md px-3 py-2 bg-white" />
                        </div>

                        <div>
                            <label class="block text-sm font-medium muted">Endereço</label>
                            <input id="endereco" class="mt-1 w-full border border-gray-200 rounded-md px-3 py-2 bg-white" />
                        </div>

                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-sm font-medium muted">Contato (email)</label>
                                <input id="email" type="email" class="mt-1 w-full border border-gray-200 rounded-md px-3 py-2 bg-white" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium muted">Telefone</label>
                                <input id="telefone" class="mt-1 w-full border border-gray-200 rounded-md px-3 py-2 bg-white" />
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-sm font-medium muted">Funcionários</label>
                                <input id="funcionarios" type="number" min="0" class="mt-1 w-full border border-gray-200 rounded-md px-3 py-2 bg-white" />
                            </div>

                            <div>
                                <label class="block text-sm font-medium muted">Logo (URL)</label>
                                <input id="logo" class="mt-1 w-full border border-gray-200 rounded-md px-3 py-2 bg-white" placeholder="https://..." />
                            </div>
                        </div>

                        <div class="flex items-center gap-2 justify-end">
                            <button type="button" id="cancelBtn" class="px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200">Cancelar</button>
                            <button type="button" id="limparBtn" class="px-4 py-2 rounded-md bg-gray-50 border border-gray-100 hover:bg-gray-50">Limpar</button>
                            <button type="submit" id="submitBtn" class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">Adicionar Empresa</button>
                        </div>

                        <input type="hidden" id="editIndex" />
                    </form>
                </section>

                <!-- Resumo + Lista -->
                <section class="col-span-2 space-y-4">
                    <div class="card p-5 flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold" style="color:var(--primary)">Resumo das Empresas</h3>
                            <p class="text-sm muted">Visualize e gerencie empresas cadastradas</p>
                        </div>
                        <div class="text-right">
                            <p id="totalEmpresas" class="font-bold text-2xl">0</p>
                            <p class="text-sm muted">Total</p>
                        </div>
                    </div>

                    <div class="card p-4">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-semibold">Empresas cadastradas</h4>
                            <div class="flex items-center gap-2">
                                <div class="relative">
                                    <span class="absolute inset-y-0 left-3 flex items-center text-gray-400"><i class="fa-solid fa-magnifying-glass"></i></span>
                                    <input id="search" placeholder="Pesquisar por nome ou CNPJ..." class="pl-10 pr-3 py-2 border border-gray-200 rounded-lg w-64" />
                                </div>
                                <button id="exportBtn" title="Exportar JSON" class="px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200">
                                    <i class="fa-solid fa-file-export"></i>
                                </button>
                            </div>
                        </div>

                        <div id="empresasList" class="grid grid-cols-1 gap-3 max-h-[55vh] overflow-auto pr-2">
                            <!-- items inseridos dinamicamente -->
                        </div>

                        <div id="emptyState" class="hidden text-center muted p-8">
                            <div class="mx-auto w-36 h-36 rounded-full bg-gradient-to-tr from-cyan-100 to-blue-50 flex items-center justify-center mb-4">
                                <i class="fa-solid fa-building text-4xl text-cyan-600"></i>
                            </div>
                            <p class="text-sm">Nenhuma empresa cadastrada ainda. Clique em <span class="font-medium">Cadastrar</span> para adicionar a primeira.</p>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Preview modal -->
        <div id="previewModal" class="hidden fixed inset-0 bg-black/40 z-50 flex items-center justify-center">
            <div class="bg-white rounded-lg w-11/12 md:w-2/3 p-6 shadow-lg">
                <div class="flex justify-between items-start">
                    <h3 class="text-lg font-semibold">Pré-visualização da Empresa</h3>
                    <button id="closePreview" class="text-gray-500 hover:text-gray-800"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div id="previewContent" class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                    <!-- conteúdo dinâmico -->
                </div>
            </div>
        </div>

        <footer class="bg-white border-t mt-12 py-6">
            <div class="container mx-auto px-4 text-center muted">
                <p>© 2025 OmniRH. Administração de Empresas.</p>
            </div>
        </footer>

        <script>
            // armazenamento local simples (localStorage)
            const form = document.getElementById('empresaForm');
            const empresasListEl = document.getElementById('empresasList');
            const totalEmpresasEl = document.getElementById('totalEmpresas');
            const previewModal = document.getElementById('previewModal');
            const previewContent = document.getElementById('previewContent');
            const editIndexInput = document.getElementById('editIndex');
            const searchInput = document.getElementById('search');
            const formSection = document.getElementById('formSection');
            const openFormBtn = document.getElementById('openFormBtn');
            const submitBtn = document.getElementById('submitBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const formTitle = document.getElementById('formTitle');
            const emptyState = document.getElementById('emptyState');

            function loadEmpresas() { return JSON.parse(localStorage.getItem('omni_empresas') || '[]'); }
            function saveEmpresas(list) { localStorage.setItem('omni_empresas', JSON.stringify(list)); }

            function updateEmptyState() {
                const has = loadEmpresas().length > 0;
                emptyState.classList.toggle('hidden', has);
            }

            function renderList(filter = '') {
                const empresas = loadEmpresas();
                const filtered = empresas.filter(e => (e.nome || '').toLowerCase().includes(filter.toLowerCase()) || (e.cnpj||'').includes(filter));
                empresasListEl.innerHTML = '';
                if (filtered.length === 0) {
                    empresasListEl.innerHTML = '';
                }
                filtered.forEach((emp, idx) => {
                    const card = document.createElement('div');
                    card.className = 'flex items-center justify-between p-3 border border-gray-100 rounded-lg hover:shadow transition';
                    card.innerHTML = `
                        <div class="flex items-center gap-3">
                            <div class="w-14 h-14 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center">
                                <img src="${emp.logo || 'https://via.placeholder.com/56'}" alt="logo" class="w-full h-full object-cover" />
                            </div>
                            <div>
                                <div class="font-semibold">${emp.nome}</div>
                                <div class="text-sm muted">${emp.setor || '—'} • <span class="accent-text">${emp.status}</span></div>
                                <div class="text-xs muted">${emp.cnpj || ''}</div>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button data-idx="${idx}" class="previewBtn px-3 py-1 bg-indigo-50 text-indigo-700 rounded-md">Visualizar</button>
                            <button data-idx="${idx}" class="editBtn px-3 py-1 bg-yellow-50 text-yellow-700 rounded-md">Editar</button>
                            <button data-idx="${idx}" class="delBtn px-3 py-1 bg-red-50 text-red-700 rounded-md">Excluir</button>
                        </div>
                    `;
                    empresasListEl.appendChild(card);
                });
                totalEmpresasEl.textContent = empresas.length;
                updateEmptyState();
                attachListActions();
            }

            function attachListActions() {
                document.querySelectorAll('.previewBtn').forEach(b => b.onclick = () => previewEmpresa(loadEmpresas()[b.dataset.idx]));
                document.querySelectorAll('.editBtn').forEach(b => {
                    b.onclick = () => {
                        const emp = loadEmpresas()[b.dataset.idx];
                        // preencher campos
                        document.getElementById('nome').value = emp.nome || '';
                        document.getElementById('cnpj').value = emp.cnpj || '';
                        document.getElementById('setor').value = emp.setor || '';
                        document.getElementById('endereco').value = emp.endereco || '';
                        document.getElementById('email').value = emp.email || '';
                        document.getElementById('telefone').value = emp.telefone || '';
                        document.getElementById('funcionarios').value = emp.funcionarios || '';
                        document.getElementById('status').value = emp.status || 'Ativa';
                        document.getElementById('logo').value = emp.logo || '';
                        editIndexInput.value = b.dataset.idx;
                        // mostrar o formulário ao editar
                        openForm({ mode: 'edit' });
                    };
                });
                document.querySelectorAll('.delBtn').forEach(b => {
                    b.onclick = () => {
                        if (!confirm('Excluir empresa?')) return;
                        const list = loadEmpresas();
                        list.splice(b.dataset.idx, 1);
                        saveEmpresas(list);
                        renderList(searchInput.value);
                    };
                });
            }

            function previewEmpresa(emp) {
                previewContent.innerHTML = `
                    <div class="col-span-1 flex justify-center">
                        <img src="${emp.logo || 'https://via.placeholder.com/160'}" class="w-40 h-40 object-cover rounded" />
                    </div>
                    <div class="col-span-2">
                        <h4 class="text-xl font-bold">${emp.nome}</h4>
                        <p class="text-sm muted">${emp.setor || ''} • <span class="accent-text">${emp.status}</span></p>
                        <p class="mt-2"><span class="font-semibold muted">CNPJ:</span> ${emp.cnpj || '—'}</p>
                        <p><span class="font-semibold muted">Endereço:</span> ${emp.endereco || '—'}</p>
                        <p><span class="font-semibold muted">Contato:</span> ${emp.email || '—'} • ${emp.telefone || '—'}</p>
                        <p class="mt-2 text-sm muted"><span class="font-semibold">Funcionários:</span> ${emp.funcionarios || 0}</p>
                    </div>
                `;
                previewModal.classList.remove('hidden');
            }

            document.getElementById('closePreview').onclick = () => previewModal.classList.add('hidden');
            previewModal.onclick = (e) => { if (e.target === previewModal) previewModal.classList.add('hidden'); };

            function openForm({ mode = 'add' } = {}) {
                form.reset();
                formSection.classList.remove('hidden');
                formSection.classList.add('animate-in');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                if (mode === 'edit') {
                    submitBtn.textContent = 'Salvar';
                    formTitle.textContent = 'Editar empresa';
                } else {
                    submitBtn.textContent = 'Adicionar Empresa';
                    formTitle.textContent = 'Cadastrar nova empresa';
                    editIndexInput.value = '';
                }
            }

            // abrir formulário para novo cadastro
            openFormBtn.onclick = () => openForm({ mode: 'add' });

            // cancelar/fechar form
            cancelBtn.onclick = () => {
                formSection.classList.add('hidden');
                editIndexInput.value = '';
            };

            // limpar form
            document.getElementById('limparBtn').onclick = () => form.reset();

            // form submit
            form.addEventListener('submit', (ev) => {
                ev.preventDefault();
                const list = loadEmpresas();
                const data = {
                    nome: document.getElementById('nome').value.trim(),
                    cnpj: document.getElementById('cnpj').value.trim(),
                    setor: document.getElementById('setor').value.trim(),
                    endereco: document.getElementById('endereco').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    telefone: document.getElementById('telefone').value.trim(),
                    funcionarios: Number(document.getElementById('funcionarios').value) || 0,
                    status: document.getElementById('status').value,
                    logo: document.getElementById('logo').value.trim()
                };
                const editIndex = editIndexInput.value;
                if (editIndex) {
                    list[editIndex] = data;
                    editIndexInput.value = '';
                } else {
                    list.unshift(data); // adiciona no topo
                }
                saveEmpresas(list);
                form.reset();
                // esconder formulário após salvar
                formSection.classList.add('hidden');
                renderList(searchInput.value);
            });

            // pesquisa / export
            searchInput.addEventListener('input', () => renderList(searchInput.value));
            document.getElementById('exportBtn').onclick = () => {
                const data = JSON.stringify(loadEmpresas(), null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'empresas_omni.json';
                a.click();
                URL.revokeObjectURL(url);
            };

            // iniciar
            renderList();
        </script>
        <script src="/js/empresa.js"></script>
    </body>
</html>
