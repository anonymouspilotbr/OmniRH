<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Perfil do Colaborador - OmniRH</title>
        <script src="https://cdn.tailwindcss.com"></script> 
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> 
        <style>
            .bg-gradient-to-r.from-blue-900.to-blue-800.rounded-2xl.p-8.text-white.shadow-xl{
                padding: 1rem;
            }
            .container.mx-auto.px-4.py-8{
                padding-top: 1rem;
                padding-bottom: 1rem;
            }
            div.mb-12{
                margin-bottom: 1rem;
            }
            .progress-bar {
                transition: width 0.5s ease-in-out;
            }
        </style>
    </head>
    <body class="bg-gray-50 min-h-screen">
        <header class="bg-blue-600 text-white shadow-lg"> 
            <div class="container mx-auto px-4 py-6"> 
                <div class="flex items-center justify-between"> 
                    <div class="flex items-center space-x-4"> 
                        <button id="menuButton">
                            <i class="fa-solid fa-bars"></i>
                        </button>
                        <div> 
                            <h1 class="text-2xl font-bold">OmniRH</h1> 
                            <p class="text-blue-100 text-sm">Perfil do Colaborador</p> 
                        </div> 
                    </div> 
                    <div class="flex items-center space-x-4"> 
                        <div class="text-right"> 
                            <p class="font-semibold">Maria Oliveira Silva Costa</p> 
                            <p class="text-blue-200 text-sm">Recursos Humanos</p> 
                        </div> 
                        <div class="relative w-12 h-12 bg-blue-500 rounded-full overflow-hidden flex items-center justify-center bg-blue-500">
                            <i id="headerIcon" class="fas fa-user text-white text-xl"></i>
                            <img id="headerFoto" class="hidden w-full h-full object-cover" alt="Foto do usuário">
                            <button id="usericon" class="absolute inset-0 z-10 w-full h-full bg-transparent cursor-pointer"></button>
                        </div>
                        <div id="usermenu" class="hidden absolute top-24 right-0 bg-white text-gray-800 rounded-lg shadow-lg w-40 z-50">
                            <button class="w-full text-left px-4 py-2 hover:bg-gray-100" onclick="accessPerfil()">Perfil</button>
                            <button class="w-full text-left px-4 py-2 hover:bg-gray-100" onclick="ajuda()">Ajuda</button>
                            <button class="w-full text-left px-4 py-2 hover:bg-gray-100" onclick="sair()">Sair</button>
                        </div>
                    </div> 
                </div> 
            </div> 
        </header>
        <aside id="sidebar" class="fixed top-0 left-0 h-full w-56 bg-blue-600 text-white p-4 space-y-2 transform -translate-x-full transition-transform duration-300 ease-in-out z-50">
            <div class="flex items-center justify-between py-2">
                <h2 class="text-xl font-semibold">OmniRH</h2>
                <button id="closeButton">
                    <i class="fa-solid fa-rectangle-xmark"></i>
                </button>
            </div>
            <button id="menu-home" class="text-left px-4 py-2 rounded-lg hover:bg-blue-500 transition"><i class="fa-solid fa-file"></i> Folha de Ponto</button>
            <button id="menu-recesso" class="text-left px-4 py-2 rounded-lg hover:bg-blue-500 transition"><i class="fa-solid fa-umbrella-beach"></i> Solicitar Recessos</button>
            <button id="menu-licencas" class="text-left px-4 py-2 rounded-lg hover:bg-blue-500 transition"><i class="fa-solid fa-file-signature"></i> Licenças</button>
            <button id="menu-horas" class="text-left px-4 py-2 rounded-lg hover:bg-blue-500 transition"><i class="fa-solid fa-clock"></i> Banco de Horas</button>
        </aside>
        <div id="overlay" class="hidden fixed inset-0 bg-black/40 z-40"></div>
        <main class="container mx-auto px-4 py-8">
            <div class="flex justify-end mb-4">
                <button id="edit-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300">
                    <i class="fas fa-pencil-alt mr-2"></i>Editar Perfil
                </button>
                <div id="edit-actions" class="hidden">
                    <button id="save-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 mr-2">
                        <i class="fas fa-save mr-2"></i>Salvar
                    </button>
                    <button id="cancel-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300">
                        <i class="fas fa-times mr-2"></i>Cancelar
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Coluna esquerda: Informações pessoais e foto -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                        <div class="flex flex-col items-center">
                            <div class="relative group w-32 h-32 rounded-full overflow-hidden mb-4">
                                <img id="fotoUser" src="" alt="Foto de Perfil" class="w-full h-full object-cover hidden">
                                <div id="placeholder" class="w-full h-full bg-blue-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-blue-500 text-5xl"></i>
                                </div>
                                <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                                    <i class="fas fa-pen text-white text-2xl"></i>
                                </div>
                                <input type="file" id="fotoPerfil" name="fotoPerfil" accept="image/*" class="hidden">
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800 view-mode">Maria Oliveira Silva Costa</h2>
                            <input type="text" class="edit-mode hidden form-input w-full text-2xl font-bold border-gray-300 rounded-md shadow-sm text-center" value="Maria Oliveira Silva Costa">
                            <p id="cargoUser" class="text-blue-600 font-medium">Analista de Recursos Humanos</p>
                            <p id="idUser" class="text-gray-500 mt-2">ID: 12345</p>
                            
                            <div class="w-full mt-6 border-t pt-4">
                                <div class="flex justify-between mb-2">
                                    <span class="text-gray-600">Status</span>
                                    <span class="px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">Ativo</span>
                                </div>
                                <div class="flex justify-between mb-2">
                                    <span class="text-gray-600">Data de Admissão</span>
                                    <span class="text-gray-800 font-medium"><span class="data-admissao">15/03/2020</span></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Tempo de Empresa</span>
                                    <span class="text-gray-800 font-medium"><span class="tempo-servico">4 anos, 6 meses</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Contato</h3>
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <i class="fas fa-envelope text-blue-500 w-6"></i>
                                <span id="view-email" class="text-gray-600 view-mode">maria.oliveira@empresa.com</span>
                                <input type="email" id="edit-email" class="edit-mode hidden form-input w-full ml-2 border-gray-300 rounded-md shadow-sm" value="">
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-phone text-blue-500 w-6"></i>
                                <span id="view-telefone" class="text-gray-600 view-mode">(61) 98765-4321</span>
                                <input type="text" id="edit-telefone" class="edit-mode hidden form-input w-full ml-2 border-gray-300 rounded-md shadow-sm" value="">
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-users text-blue-500 w-6"></i>
                                <span class="text-gray-600">Departamento: <span class="info-departamento">RH</span></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Informações Profissionais</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-gray-500 text-sm">Cargo</p>
                                <p id="cargoUser" class="text-gray-800 font-medium"><span class="info-cargo">Analista de Recursos Humanos</span></p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">Departamento</p>
                                <p class="text-gray-800 font-medium"><span class="info-departamento2">Recursos Humanos</span></p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">Gestor</p>
                                <p class="text-gray-800 font-medium"><span class="info-gestor">Carlos Mendonça de Almeida</span></p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">Jornada de Trabalho</p>
                                <p class="text-gray-800 font-medium"><span class="info-horario-entrada">08:00</span> às <span class="info-horario-saida">18:00</span></p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">Regime de Trabalho</p>
                                <p class="text-gray-800 font-medium"><span class="info-regime">CLT</span></p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">Salário</p>
                                <p class="text-gray-800 font-medium">R$ <span class="info-salario">5.800,00</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Benefícios</h3>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full border border-blue-300">Vale-Alimentação</span>
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full border border-blue-300">Plano de Saúde</span>
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full border border-blue-300">Plano Odontológico</span>
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full border border-blue-300">Gympass</span>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Férias e Licenças</h3>
                        <div class="mb-4">
                            <div class="flex justify-between mb-1">
                                <span class="text-gray-600">Dias de férias disponíveis</span>
                                <span class="text-gray-800 font-medium">15 dias</span>
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="flex justify-between mb-1">
                                <span class="text-gray-600">Licenças médicas este ano</span>
                                <span class="text-gray-800 font-medium">3 dias</span>
                            </div>
                        </div>
                        <div class="mt-6 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <button id="botao-recesso" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full">
                                <i class="fas fa-calendar-alt mr-2"></i>Solicitar Recessos
                            </button>
                            <button id="botao-licenca" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 w-full">
                                <i class="fas fa-file-alt mr-2"></i>Abrir Processo de Licença
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer class="bg-gray-800 text-white py-8 mt-12">
            <div class="container mx-auto px-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div>
                        <h4 class="font-semibold mb-4">OmniRH</h4>
                        <p class="text-gray-400">Gestão eficiente de recursos humanos</p>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-4">Contato</h4>
                        <p class="text-gray-400">omnirh@gmail.com</p>
                        <p class="text-gray-400">(61) 9876-5432</p>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-4">Links Úteis</h4>
                        <a href="#" class="block text-gray-400 hover:text-white mb-2">Política de Recessos</a>
                        <a href="#" class="block text-gray-400 hover:text-white">Portal do Colaborador</a>
                    </div>
                </div>
                <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
                    <p>© 2025 OmniRH. Todos os direitos reservados.</p>
                </div>
            </div>
        </footer>
        <script>
            const editBtn = document.getElementById('edit-btn');
            const saveBtn = document.getElementById('save-btn');
            const cancelBtn = document.getElementById('cancel-btn');
            const editActions = document.getElementById('edit-actions');

            const viewEmail = document.getElementById('view-email');
            const editEmail = document.getElementById('edit-email');
            const viewTelefone = document.getElementById('view-telefone');
            const editTelefone = document.getElementById('edit-telefone');

            function toggleEditMode(isEditing) {
                editBtn.classList.toggle('hidden', isEditing);
                editActions.classList.toggle('hidden', !isEditing);

                editEmail.classList.toggle('hidden', !isEditing);
                viewEmail.classList.toggle('hidden', isEditing);

                editTelefone.classList.toggle('hidden', !isEditing);
                viewTelefone.classList.toggle('hidden', isEditing);
            }

            editBtn.addEventListener('click', () => {
                editEmail.value = viewEmail.innerText.trim();
                editTelefone.value = viewTelefone.innerText.trim();
                toggleEditMode(true);
            });

            saveBtn.addEventListener('click', async () => {
                const novoEmail = editEmail.value.trim();
                const novoTelefone = editTelefone.value.trim();

                viewEmail.innerText = novoEmail;
                viewTelefone.innerText = novoTelefone;
                toggleEditMode(false);

                try{
                    const token = localStorage.getItem('token');

                    const response = await fetch('/me/contato', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({ email: novoEmail, telefone: novoTelefone })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        alert('Erro ao atualizar contato: ' + data.msg);
                    } else {
                        console.log('Contato atualizado:', data.usuario);
                    }
                } catch (err) {
                    console.error(err);
                    alert('Erro de rede ao atualizar contato.');
                }
            });

            cancelBtn.addEventListener('click', () => {
                toggleEditMode(false);
            });

            function accessPerfil(){
                window.location.href = "perfil";
            }
            function ajuda(){
                window.location.href = "registro-chamados";
            }
            function sair(){
                window.location.href = "/";
            }
        </script>
        <script src="/js/front.js"></script>
        <script src="/js/uploads.js"></script>
    </body>
</html>
